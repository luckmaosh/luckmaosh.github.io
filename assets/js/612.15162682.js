(window.webpackJsonp=window.webpackJsonp||[]).push([[612],{2044:function(s,a,n){"use strict";n.r(a);var t=n(5),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"阿里云直播"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阿里云直播"}},[s._v("#")]),s._v(" 阿里云直播")]),s._v(" "),a("h2",{attrs:{id:"目前的协议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目前的协议"}},[s._v("#")]),s._v(" 目前的协议")]),s._v(" "),a("ul",[a("li",[s._v("HLS(HTTP Live Streaming) HTML5的video标签并不能直接播放hls直播流，需要借助插件来实现。关于插件的话网上也搜了一大堆用来测试，发现免费还好用的应该算是video.js了，video.js也是专门针对hls直播流做了一个依赖video.js的插件videojs-contrib-hls.js。前端页面")]),s._v(" "),a("li",[s._v("Real Time Messaging Protocol（简称 RTMP）是 Macromedia 开发的一套视频直播协议，现在属于 Adobe。和 HLS 一样都可以应用于视频直播，区别是 RTMP 基于 flash 无法在 iOS 的浏览器里播放，但是实时性比 HLS 要好。所以一般使用这种协议来上传视频流，也就是视频流推送到服务器。 浏览器端，HTML5 video标签无法播放 RTMP 协议的视频，可以通过 video.js 来实现。")]),s._v(" "),a("li",[s._v("🔽RTSP:(Real Time Streaming Protocol)")]),s._v(" "),a("li",[s._v("🔽HTTP-FLV 基于http")])]),s._v(" "),a("h2",{attrs:{id:"阿里云添加域名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阿里云添加域名"}},[s._v("#")]),s._v(" 阿里云添加域名")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://help.aliyun.com/document_detail/98296.html?spm=a2c4g.11186623.6.579.2dd84d25R499CD",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://help.aliyun.com/document_detail/98296.html?spm=a2c4g.11186623.6.579.2dd84d25R499CD"),a("OutboundLink")],1)]),s._v(" "),a("ul",[a("li",[s._v("播流域名")]),s._v(" "),a("li",[s._v("推流域名")])]),s._v(" "),a("h3",{attrs:{id:"pc端推流与播流整体架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pc端推流与播流整体架构"}},[s._v("#")]),s._v(" PC端推流与播流整体架构")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/0082zybply1gc8gw8abs1j30nc0d241d.jpg",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/0082zybply1gc8gxdlqljj30nc0ftdmf.jpg",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"服务搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务搭建"}},[s._v("#")]),s._v(" 服务搭建")]),s._v(" "),a("p",[s._v("服务器的作用是视频转存和分发，有付费也有免费的开源方案。付费的比如阿里云的直播服务，也可以自己搭建，这里说说自己搭建。搭建的方法有两种，")]),s._v(" "),a("ul",[a("li",[s._v("nginx搭建")]),s._v(" "),a("li",[s._v("srs搭建 https://github.com/ossrs/srs/tree/3.0release/trunk")])]),s._v(" "),a("p",[s._v("整个直播的业务架构是：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("+---------+      +-----------------+       +---------+\n| Encoder +--\x3e---+ SRS/CDN Network +---\x3e---+ Player  |\n+---------+      +-----------------+       +---------+\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("客户端推流(Encoder)和播放器(Player)的架构一般是：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("+-------------------------------------------+\n|           Device(Out/In YUV/PCM)          |\n+-------------------------------------------+\n|   Codec(YUV/PCM to/from H.264/AAC stream) |\n+-------------------------------------------+\n|   Muxer(H.264/AAC to/from FLV/MP4/HLS)    |\n+-------------------------------------------+\n|          Transport(RTMP/HTTP/UDP)         |\n+-------------------------------------------+\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("srs配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# main config for srs.\n# @see full.conf for detail config.\n\nlisten              1935;\nmax_connections     1000;\nsrs_log_tank        file;\nsrs_log_file        ./objs/srs.log;\n\n# 内置Nginx 代理\nhttp_server {\n    enabled         on;\n    listen          8080;\n    dir             ./objs/nginx/html;\n}\nvhost __defaultVhost__ {\n    # hls直播（手机端）\n    hls {\n        enabled         on;\n        hls_fragment    10;\n        hls_window      60;\n        hls_path        ./objs/nginx/html;\n        hls_m3u8_file   [app]/[stream].m3u8;\n        hls_ts_file     [app]/[stream]-[seq].ts;\n    }\n    # flv直播\n    http_remux {\n        enabled     on;\n        mount       [vhost]/[app]/[stream].flv;\n        hstrs       on;\n    }\n}\n\n# vhost多租用\nvhost dvr.com {\n    hls {\n        enabled off;\n    }\n\n    dvr {\n        enabled      on;\n        dvr_path     ./objs/nginx/html/[app]/[stream].[timestamp].flv;\n        dvr_plan     session;\n    }\n}\ndvr录制存储配置规则\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br")])]),a("p",[s._v("启动srs")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("./objs/srs -c ./conf/srs.conf\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"推流工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#推流工具"}},[s._v("#")]),s._v(" 推流工具")]),s._v(" "),a("h3",{attrs:{id:"ffmpeg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ffmpeg"}},[s._v("#")]),s._v(" ffmpeg")]),s._v(" "),a("p",[s._v("开源的，https://git.ffmpeg.org/ffmpeg.git，")]),s._v(" "),a("h3",{attrs:{id:"obs推流工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#obs推流工具"}},[s._v("#")]),s._v(" OBS推流工具")]),s._v(" "),a("p",[s._v("Open Broadcaster Software（简称OBS）是一款好用的直播流媒体内容制作软件。")]),s._v(" "),a("ul",[a("li",[s._v("使用obs录取屏幕\nhttps://blog.csdn.net/liuchen1206/article/details/77771703")])]),s._v(" "),a("p",[a("a",{attrs:{href:"https://help.aliyun.com/document_detail/45212.html?spm=a2c4g.11186623.2.15.15f625cfRm5DzU",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://help.aliyun.com/document_detail/45212.html?spm=a2c4g.11186623.2.15.15f625cfRm5DzU"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("推流地址：\n"),a("code",[s._v("rtmp://localhost/[app]/[stream]")])]),s._v(" "),a("p",[s._v("例如 "),a("code",[s._v("rtmp://localhost/live/stream1")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/0082zybply1gcazu6otrsj30wu082772.jpg",alt:""}})]),s._v(" "),a("blockquote",[a("p",[s._v("注意：OBS推流时，流名称的翻译有问题，流名称是要写在流密钥这里的，如下图所示。")])]),s._v(" "),a("h2",{attrs:{id:"播放流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#播放流"}},[s._v("#")]),s._v(" 播放流")]),s._v(" "),a("p",[s._v("两种方式： vlc播放器，或者h5播放")]),s._v(" "),a("p",[s._v("vlc就可以直接下载播放器播放，这里看看h5的播放\n"),a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/0082zybply1gc8selxklbj30iu079mxr.jpg",alt:""}}),s._v("\n简简单单的代码，重点在于拉流地址必须与推流地址一致")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("https://pay.weixin.qq.com/static/applyment_guide/applyment_detail_website.shtml")])]),s._v(" "),a("li",[a("p",[s._v("https://docs.open.alipay.com/270/105899/")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);