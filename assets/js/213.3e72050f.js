(window.webpackJsonp=window.webpackJsonp||[]).push([[213],{1735:function(t,o,e){"use strict";e.r(o);var n=e(5),s=Object(n.a)({},(function(){var t=this,o=t._self._c;return o("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[o("h1",{attrs:{id:"document-查询内部原理图解揭秘"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#document-查询内部原理图解揭秘"}},[t._v("#")]),t._v(" document 查询内部原理图解揭秘")]),t._v(" "),o("ol",[o("li",[o("p",[t._v("客户端发送请求到任意一个 node，成为 coordinate node")])]),t._v(" "),o("li",[o("p",[t._v("coordinate node 对 document 进行路由，将请求转发到对应的 node")]),t._v(" "),o("p",[t._v("此时会使用 round-robin 随机轮询算法，在 primary shard 以及其所有 replica 中随机选择一个，让读请求负载均衡")])]),t._v(" "),o("li",[o("p",[t._v("接收请求的 node 返回 document 给 coordinate node")])]),t._v(" "),o("li",[o("p",[t._v("coordinate node 返回 document 给客户端")])])]),t._v(" "),o("p",[o("strong",[t._v("特殊情况：")])]),t._v(" "),o("p",[t._v("document 如果还在建立索引过程中，可能只有 primary shard 有，任何一个 replica shard 都没有，\n此时可能会导致无法读取到 document，但是 document 完成索引建立之后，primary shard 和 replica shard 就都有了")]),t._v(" "),o("div",{staticClass:"custom-block warning"},[o("p",{staticClass:"custom-block-title"},[t._v("疑问")]),t._v(" "),o("p",[t._v("对于这种情况没有处理么？在 mysql 的一些读写分离应用中，就会出现这种情况，")]),t._v(" "),o("p",[t._v("master 写入后，slave 还没有来得及同步，这个时候流量被转发到 slave 的时候无法获取到数据")]),t._v(" "),o("p",[t._v("一般的做法是：强制走 master；那么对于 es 来说这种场景怎么办？")])]),t._v(" "),o("p",[o("img",{attrs:{src:e(922),alt:""}})])])}),[],!1,null,null,null);o.default=s.exports},922:function(t,o,e){t.exports=e.p+"assets/img/markdown-img-paste-20190106221035878.79b98358.png"}}]);